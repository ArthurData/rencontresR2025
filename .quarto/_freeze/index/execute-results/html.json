{
  "hash": "cdc7634699f0e9c420db4246e0c2dcd3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tester une application Shiny\"\nsubtitle: M√©thodologie et outils pratiques\nformat: \n  thinkridentity-revealjs:\n    theme: custom.scss\n    slideNumber: true\nchalkboard: false\nauthor: arthurdata.github.io/rencontresR2025\ninclude-before-body: assets/ground.html\ndate: last-modified\n---\n\n\n\n# Bonjour\n\n# Il y a deux ans...\n\nLors des Rencontres R 2023...\n\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n::: {.fragment .fade-right}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### Rencontre de Pierrot\n:::\n\n::: {.fragment .fade-left}\nIl voulait refaire sa cuisine\n:::\n\n::: {.fragment .fade-left}\nIl devait produire une application Shiny pour un client\n:::\n:::\n::::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### Il avait alors eu une <span class=\"relevant\">r√©v√©lation</span>\n:::\n\n::: {.fragment .fade-left}\nL'importance d'une maquette pour : \n:::\n\n::: {.fragment .fade-left}\n- La conception de sa cuisine\n- La r√©alisation de l'application Shiny\n:::\n:::\n::::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### 2 ans apr√®s... la suite\n:::\n\n::: {.fragment .fade-left}\nSuite √† sa visite dans cette grande enseigne su√©doise :\n:::\n\n::: {.fragment .fade-left}\n- Il a tout achet√© : les meubles, les outils, _etc..._\n:::\n\n::: {.fragment .fade-left}\nLa maquette est valid√©e avec son client\n:::\n\n::: {.fragment .fade-left}\n- Il est pr√™t √† se lancer dans le dev\n:::\n:::\n::::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### Voici venu le temps de la <span class=\"relevant\">production</span>\n:::\n\n::: {.fragment .fade-left}\nPierrot va devoir monter sa cuisine :\n\n- Assembler les meubles, fixer, viser, _etc..._\n- Faire attention √† ne rien casser\n:::\n\n::: {.fragment .fade-left}\nEt surtout :\n:::\n\n::: {.fragment .fade-left}\nS'assurer une qualit√© de montage suffisante pour les ann√©es √† venir\n:::\n:::\n::::\n\n# Il y a le plan de la maquette ...\n\n# ... et la r√©alisation\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"25%\"}\n:::\n\n::: {.column width=\"75%\"}\n### Les craintes de Pierrot...\n\n::: {.fragment .fade-left}\n- Une cuisine mal mont√©e,\n- Une cuisine pas robuste,\n- _etc..._\n:::\n:::\n::::\n\n## Les craintes de Pierrot... \n\n::: {.r-stack}\n![](assets/failed1.webp){.fragment width=\"650\" height=\"600\"}\n\n![](assets/failed2.webp){.fragment width=\"650\" height=\"600\"}\n\n![](assets/failed3.webp){.fragment width=\"650\" height=\"600\"}\n:::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"25%\"}\n:::\n\n::: {.column width=\"75%\"}\n### Que Pierrot soit rassur√©\n\n::: {.fragment .fade-left}\nLe vendeur lui assure que  :\n\n- **Le mat√©riel est test√©** : les vis, les placards, _etc..._ sont soumis √† des tests de charge\n\n- **L'outil de conception** montre les erreurs √©ventuelles\n:::\n:::\n::::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n::: {.fragment .fade-right}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### C'est une nouvelle <span class=\"relevant\">r√©v√©lation</span>\n:::\n\n::: {.fragment .fade-left}\nEt si Pierrot utilisait des tests pour l'application Shiny de son client ?\n:::\n:::\n::::\n\n## Pierrot\n\n:::: {.columns}\n::: {.column width=\"25%\"}\n:::\n\n::: {.column width=\"75%\"}\n### Pierrot est convaincu\n\nFaire des tests pour son application Shiny va lui permettre de : \n\n::: {.fragment .fade-left}\n- Valider progressivement avec son client, les √©tapes de d√©veloppement\n\n- S'assurer de ne rien casser en modifiant et/ou en ajoutant du code\n\n- Augmenter la robustesse de l'application\n:::\n:::\n::::\n\n# Les tests dans Shiny\n\n# Les tests unitaires\n\n_Comment s'assurer que chaque tiroir s'ouvre <br> correctement avant de l'installer dans la cuisine..._\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/unit_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### Tester un tiroir individuellement\n\nComme v√©rifier qu'un tiroir s'ouvre et se ferme correctement, les tests unitaires dans Shiny permettent de :\n\n::: {.fragment .fade-left}\n- V√©rifier qu'une fonction retourne la bonne valeur\n- S'assurer que les erreurs sont correctement g√©r√©es\n- Tester le comportement d'une fonction avec diff√©rents inputs\n:::\n:::\n::::\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/testunitaire.png)\n:::\n\n::: {.column width=\"55%\"}\n### Tester un tiroir individuellement\n\nPierrot va tester les diff√©rentes sorties d‚Äôune fonction, de mani√®re ind√©pendante des autres fonctions.\n:::\n::::\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/testunitaire.png)\n:::\n\n::: {.column width=\"55%\"}\n### La bonne nouvelle\n\nPierrot a suivi le tutoriel des <span class=\"relevant\">#RR25</span> de lundi matin sur `{Golem}` ! \n\nSon application Shiny est donc un <span class=\"relevant\">package</span>, ce qui va faciliter la cr√©ation des tests unitaires.\n:::\n::::\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n```\nmyShinyApp/\n‚îú‚îÄ‚îÄ DESCRIPTION\n‚îú‚îÄ‚îÄ NAMESPACE\n‚îú‚îÄ‚îÄ app.R\n‚îú‚îÄ‚îÄ R/\n‚îÇ   ‚îú‚îÄ‚îÄ app_ui.R\n‚îÇ   ‚îú‚îÄ‚îÄ app_server.R\n‚îÇ   ‚îî‚îÄ‚îÄ run_app.R\n‚îú‚îÄ‚îÄ tests/\n‚îÇ   ‚îú‚îÄ‚îÄ testthat/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-calculate_average.R\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-golem-recommended.R\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...\n‚îÇ   ‚îî‚îÄ‚îÄ testthat.R\n```\n:::\n\n::: {.column width=\"55%\"}\n### Cr√©er la structure de tests\n\nPour cr√©er la structure de tests, Pierrot peut ex√©cuter : \n\n- `golem::use_recommended_tests()`\n\n- `usethis::use_test(\"calculate_average\")`\n:::\n::::\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalculate_average <- function(values) {\n  if (!is.numeric(values)) {\n    stop(\"values doit √™tre num√©rique\")\n  }\n  if (length(values) == 0) {\n    return(0)\n  }\n  sum(values) / length(values)\n}\n```\n:::\n\n\n:::\n\n::: {.column width=\"55%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_that(\"calculate_average fonctionne\", {\n  # Test avec des valeurs num√©riques\n  expect_equal(\n    object = calculate_average(c(10, 20, 30)), \n    expected = 20\n  )\n  \n  # Test avec un vecteur vide\n  expect_equal(\n    object = calculate_average(numeric(0)), \n    expected = 0\n  )\n  \n  # Test avec input non-num√©rique\n  expect_error(\n    object = calculate_average(c(\"a\", \"b\")), \n    \"values doit √™tre num√©rique\"\n  )\n})\n```\n:::\n\n\n:::\n::::\n\n## Les tests unitaires\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/result_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### Un premier pas\n\nIci, Pierrot vient tester une fonction dans son application. \n\n::: {.fragment .fade-left}\nEn revanche, il ne vient pas tester directement son application, les int√©ractions, _etc..._\n:::\n\n::: {.fragment .fade-left}\nMais il vient de <span class=\"relevant\">s√©curiser la logique m√©tier derri√®re son application</span>. \n:::\n:::\n::::\n\n# Les tests d'int√©gration\n\n_Les meubles de cuisine sont test√©s individuellement, <br> mais comment savoir s'ils fonctionneront ensemble ?_\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/inte_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### Assembler les meubles entre eux\n\nComme v√©rifier que la porte du frigo ne butte pas contre le mur, les tests d'int√©gration permettent de :\n\n::: {.fragment .fade-left}\n- Tester l'emboitement des fonctions\n\n- S'assurer que les modules Shiny r√©agissent correctement\n\n- V√©rifier le bon fonctionnement des flux r√©actifs\n:::\n:::\n::::\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\\ \n\n\\ \n\n![](assets/test_usage.png)\n:::\n\n::: {.column width=\"55%\"}\n### Assembler les meubles entre eux\n\n√Ä la diff√©rence des tests unitaires, Pierrot va tester les interactions entre les fonctions.\n:::\n::::\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_ui <- function(request) {\n  fluidPage(\n    numericInput(\n      inputId = \"num1\",\n      label = \"Premiere valeur\",\n      value = 10\n    ),\n    numericInput(\n      inputId = \"num2\",\n      label = \"Seconde valeur\",\n      value = 10\n    ),\n    ...\n    actionButton(\n      inputId = \"go\",\n      label = \"Calculer !\"\n    )\n  )\n}\n```\n:::\n\n\n:::\n\n::: {.column width=\"55%\"}\n![](assets/app_inte.png){width=80%}\n:::\n::::\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_ui <- function(request) {\n  fluidPage(\n    numericInput(\n      inputId = \"num1\",\n      label = \"Premiere valeur\",\n      value = 10\n    ),\n    numericInput(\n      inputId = \"num2\",\n      label = \"Seconde valeur\",\n      value = 10\n    ),\n    ...\n    actionButton(\n      inputId = \"go\",\n      label = \"Calculer !\"\n    )\n  )\n}\n```\n:::\n\n\n:::\n\n::: {.column width=\"55%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_server <- function(input, output, session) {\n\n  rv <- reactiveValues()\n\n  observeEvent(input$go, {\n    rv$avg <- calculate_average(\n      values = c(\n        input$num1,\n        input$num2,\n        input$num3,\n        input$num4\n      )\n    )\n  })\n}\n```\n:::\n\n\n:::\n::::\n\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntestServer(app_server, {\n  session$setInputs(num1 = 5)\n  session$setInputs(num2 = 5)\n  session$setInputs(num3 = 5)\n  session$setInputs(num4 = 5)\n  session$setInputs(go = 1)\n\n  expect_equal(\n    object = rv$avg, \n    expected = 5\n  )\n\n  session$setInputs(num1 = 10)\n  session$setInputs(num2 = 20)\n  session$setInputs(num3 = 30)\n  session$setInputs(num4 = 12)\n  session$setInputs(go = 2)\n\n  expect_equal(\n    object = rv$avg,\n    expected = 18\n  )\n})\n```\n:::\n\n\n:::\n\n::: {.column width=\"55%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\napp_server <- function(input, output, session) {\n\n  rv <- reactiveValues()\n\n  observeEvent(input$go, {\n    rv$avg <- calculate_average(\n      values = c(\n        input$num1,\n        input$num2,\n        input$num3,\n        input$num4\n      )\n    )\n  })\n}\n```\n:::\n\n\n:::\n::::\n\n## Les tests d'int√©gration\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/result_tests2.png)\n:::\n\n::: {.column width=\"55%\"}\n### Un second pas\n\nIci, Pierrot vient de tester les imbrications dans son application et notamment des interactions.\n\n::: {.fragment .fade-left}\nIl vient de <span class=\"relevant\">s√©curiser le bon fonctionnement de son application</span>.\n:::\n\n::: {.fragment .fade-left}\nEn revanche, ces tests restent \"_programmatique_\" et ils ne simulent pas un vrai navigateur/utilisateur.\n:::\n:::\n::::\n\n# Les tests End-to-End\n\n_Nos meubles s'assemblent bien en th√©orie, <br>mais comment savoir si la cuisine sera vraiment utilisable par Pierrot ?_\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/e2e_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### Cuisiner un vrai repas\n\nComme cuisiner r√©ellement dans la cuisine pour s'assurer que tout est fonctionnel, les tests end-to-end permettent de :\n\n::: {.fragment .fade-left}\n- Simuler de vraies interactions utilisateur\n\n- Tester l'application dans un vrai navigateur\n\n- V√©rifier l'exp√©rience utilisateur compl√®te\n:::\n:::\n::::\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/e2e_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### Simuler un utilisateur dans un navigateur\n\nPour tester l'application dans un vrai navigateur, Pierrot va utiliser la librairie JS <span class=\"relevant\">Playwright</span>.\n\n::: {.fragment .fade-left}\nMais Pierrot est d√©veloppeur R, il va donc utiliser le nouveau package R : <span class=\"relevant\">[`{pw}`](https://github.com/ThinkR-open/pw)</span>\n:::\n:::\n::::\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"70%\"}\n![](assets/signature-r.png)\n:::\n\n::: {.column width=\"30%\"}\n### Simuler un utilisateur dans un navigateur \n\n<a href=\"https://connect.thinkr.fr/signature-r/\" target=\"_blank\">üîó `{signature.r}`</a>\n:::\n::::\n\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"70%\"}\n![](assets/tests_e2e.gif)\n:::\n\n::: {.column width=\"30%\"}\n### Simuler un utilisateur dans un navigateur\n\nCa va tr√®s vite ... mais Playwright lance dans un navigateur l'application et simule un comportement utilisateur.\n\nFonctionne pour plusieurs navigateurs : Chromium, Firefix et Webkit.\n:::\n::::\n\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"70%\"}\n![](assets/tests_e2e-2.gif)\n:::\n\n::: {.column width=\"30%\"}\n### Simuler un utilisateur dans un navigateur\n\nOn peut ralentir les tests en mode \"_trace_\"\n:::\n::::\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"70%\"}\n\n\n::: {.cell}\n\n```{.js .cell-code}\nimport { test, expect } from '@playwright/test';\n\ntest('Fill signature is working', async ({ page }) => {\n  await page.goto('http://localhost:3000/');\n  await expect(page.getByTestId(\"appName\")).toBeVisible();\n\n  await expect(page.getByTestId('firstname')).toBeVisible();\n  await expect(page.getByPlaceholder('John')).toBeEmpty();\n  await page.getByPlaceholder('John').click();\n  await page.getByPlaceholder('John').fill('Arthur');\n  await expect(page.getByTestId('signature-names')).toMatchAriaSnapshot(`- 'cell \"Arthur {{lastname}}\"'`);\n\n  await page.getByPlaceholder('Doe').fill('Br√©ant');\n  await expect(page.getByTestId('signature-names')).toMatchAriaSnapshot(`- 'cell \"Arthur Br√©ant\"'`);\n\n  await page.getByRole('button', { name: 'copy fa-solid icon Copy to' }).click();\n  await expect(page.getByText('√óPaste the signature in your')).toBeVisible();\n});\n```\n:::\n\n\n:::\n\n::: {.column width=\"30%\"}\n### Simuler un utilisateur dans un navigateur\n\nAvantage : Playwright propose de g√©n√©rer le code automatiquement en cliquant dans l'application\n:::\n::::\n\n## Les tests End-to-End\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/result_tests3.png)\n:::\n\n::: {.column width=\"55%\"}\n### Un dernier pas\n\nIci, Pierrot vient de tester dans des conditions r√©elles son application.\n\n::: {.fragment .fade-left}\nIl vient de <span class=\"relevant\">s√©curiser le bon fonctionnement de son application, tant sur la logique m√©tier que sur la partie UI</span>.\n:::\n\n::: {.fragment .fade-left}\nLes tests End-to-End fonctionnent √©galement dans la CI pour assurer √† Pierrot un continuit√© dans son d√©veloppement.\n:::\n:::\n::::\n\n# Les tests unitaires\n\n_Comment s'assurer que chaque tiroir s'ouvre <br> correctement avant de l'installer dans la cuisine..._\n\n## Les tests dans Shiny\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n![](assets/e2e_tests.png)\n:::\n\n::: {.column width=\"55%\"}\n### La cuisine parfaite de Pierrot\n\n\n::: {.fragment .fade-left}\n**Tests unitaires**\n\n- Toutes les fonctions utilitaires et m√©tiers\n:::\n\n::: {.fragment .fade-left}\n**Tests d'int√©gration**\n\n- Flux r√©actifs principaux\n:::\n\n::: {.fragment .fade-left}\n**Tests end-to-end**\n\n- Parcours utilisateur critiques ou complexes\n:::\n:::\n::::\n\n## La cuisine de Pierrot\n\n:::: {.columns}\n::: {.column width=\"45%\"}\n::: {.fragment .fade-right}\n\n\n{{< quarto-lottie src=https://lottie.host/5f2ed099-4737-471d-a199-96b7786d7c88/JhebxcrsLV.json >}}\n\n\n\n:::\n:::\n\n::: {.column width=\"55%\"}\n::: {.fragment .fade-left}\n### Le r√©sultat final\n\nGr√¢ce √† sa strat√©gie de tests √† trois niveaux :\n:::\n\n::: {.fragment .fade-left}\n- Pierrot a livr√© une application robuste\n\n- Son client est satisfait\n\n- Les modifications futures seront plus sereines\n:::\n\n::: {.fragment .fade-left}\nEt sa cuisine est parfaitement fonctionnelle !\n:::\n:::\n::::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}